!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t="undefined"!=typeof globalThis?globalThis:t||self).wretch=r()}(this,(function(){"use strict";var t=function(){return t=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var o in r=arguments[e])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t},t.apply(this,arguments)};function r(t,r,e){if(e||2===arguments.length)for(var n,o=0,i=r.length;o<i;o++)!n&&o in r||(n||(n=Array.prototype.slice.call(r,0,o)),n[o]=r[o]);return t.concat(n||Array.prototype.slice.call(r))}var e=function(n,o,i){if(void 0===i&&(i=!1),!n||!o||"object"!=typeof n||"object"!=typeof o)return n;var s=t({},n);for(var u in o)o.hasOwnProperty(u)&&(o[u]instanceof Array&&n[u]instanceof Array?s[u]=i?r(r([],n[u],!0),o[u],!0):o[u]:"object"==typeof o[u]&&"object"==typeof n[u]?s[u]=e(n[u],o[u],i):s[u]=o[u]);return s},n={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(t,e){for(var n=void 0===e?{}:e,o=n.doThrow,i=void 0===o||o,s=n.instance,u=void 0!==s&&s,c=[],a=2;a<arguments.length;a++)c[a-2]=arguments[a];var f=this.polyfills[t]||("undefined"!=typeof self?self[t]:null)||("undefined"!=typeof global?global[t]:null);if(i&&!f)throw new Error(t+" is not defined");return u&&f?new(f.bind.apply(f,r([void 0],c,!1))):f}},o=function(t,r,e,n){if(!t.getEntriesByName)return!1;var o=t.getEntriesByName(r);return!!(o&&o.length>0)&&(e(o.reverse()[0]),n.clearMeasures&&n.clearMeasures(r),i.callbacks.delete(r),i.callbacks.size<1&&(i.observer.disconnect(),n.clearResourceTimings&&n.clearResourceTimings()),!0)},i={callbacks:new Map,observer:null,observe:function(t,r){if(t&&r){var e=n.polyfill("performance",{doThrow:!1});(function(t,r){return!i.observer&&t&&r&&(i.observer=new r((function(r){i.callbacks.forEach((function(e,n){o(r,n,e,t)}))})),t.clearResourceTimings&&t.clearResourceTimings()),i.observer})(e,n.polyfill("PerformanceObserver",{doThrow:!1}))&&(o(e,t,r,e)||(i.callbacks.size<1&&i.observer.observe({entryTypes:["resource","measure"]}),i.callbacks.set(t,r)))}}},s=function(t){this.error=t},u="Content-Type";function c(t){var r;return void 0===t&&(t={}),null===(r=Object.entries(t).find((function(t){return t[0].toLowerCase()===u.toLowerCase()})))||void 0===r?void 0:r[1]}function a(t){return/^application\/.*json.*/.test(t)}var f=function(){function o(t,r,e,n,o,i){void 0===e&&(e=new Map),void 0===n&&(n=[]),void 0===o&&(o=[]),void 0===i&&(i=[]),this._url=t,this._options=r,this._catchers=e,this._resolvers=n,this._middlewares=o,this._deferredChain=i}return o.factory=function(t,r){return void 0===t&&(t=""),void 0===r&&(r={}),new o(t,r)},o.prototype.selfFactory=function(e){var n=void 0===e?{}:e,i=n.url,s=void 0===i?this._url:i,u=n.options,c=void 0===u?this._options:u,a=n.catchers,f=void 0===a?this._catchers:a,l=n.resolvers,p=void 0===l?this._resolvers:l,h=n.middlewares,d=void 0===h?this._middlewares:h,y=n.deferredChain,v=void 0===y?this._deferredChain:y;return new o(s,t({},c),new Map(f),r([],p,!0),r([],d,!0),r([],v,!0))},o.prototype.defaults=function(t,r){return void 0===r&&(r=!1),n.defaults=r?e(n.defaults,t):t,this},o.prototype.errorType=function(t){return n.errorType=t,this},o.prototype.polyfills=function(r){return n.polyfills=t(t({},n.polyfills),r),this},o.prototype.url=function(t,r){if(void 0===r&&(r=!1),r)return this.selfFactory({url:t});var e=this._url.split("?");return this.selfFactory({url:e.length>1?e[0]+t+"?"+e[1]:this._url+t})},o.prototype.options=function(t,r){return void 0===r&&(r=!0),this.selfFactory({options:r?e(this._options,t):t})},o.prototype.query=function(t,r){return void 0===r&&(r=!1),this.selfFactory({url:l(this._url,t,r)})},o.prototype.headers=function(t){return this.selfFactory({options:e(this._options,{headers:t||{}})})},o.prototype.accept=function(t){return this.headers({Accept:t})},o.prototype.content=function(t){var r;return this.headers(((r={})["Content-Type"]=t,r))},o.prototype.auth=function(t){return this.headers({Authorization:t})},o.prototype.catcher=function(t,r){var e=new Map(this._catchers);return e.set(t,r),this.selfFactory({catchers:e})},o.prototype.signal=function(r){return this.selfFactory({options:t(t({},this._options),{signal:r.signal})})},o.prototype.resolve=function(t,e){return void 0===e&&(e=!1),this.selfFactory({resolvers:e?[t]:r(r([],this._resolvers,!0),[t],!1)})},o.prototype.defer=function(t,e){return void 0===e&&(e=!1),this.selfFactory({deferredChain:e?[t]:r(r([],this._deferredChain,!0),[t],!1)})},o.prototype.middlewares=function(t,e){return void 0===e&&(e=!1),this.selfFactory({middlewares:e?t:r(r([],this._middlewares,!0),t,!0)})},o.prototype.method=function(r,o,u){void 0===o&&(o={}),void 0===u&&(u=null);var f=this.options(t(t({},o),{method:r})),l=c(f._options.headers),p="object"==typeof u&&(!f._options.headers||!l||a(l));return function(t){var r=t._url,o=t._catchers,u=t._resolvers,c=t._middlewares,a=t._options,f=new Map(o),l=e(n.defaults,a),p=n.polyfill("AbortController",{doThrow:!1,instance:!0});!l.signal&&p&&(l.signal=p.signal);var h={ref:null,clear:function(){h.ref&&(clearTimeout(h.ref),h.ref=null)}},d=function(t){return function(r){return 0===t.length?r:1===t.length?t[0](r):t.reduceRight((function(e,n,o){return o===t.length-2?n(e(r)):n(e)}))}}(c)(n.polyfill("fetch"))(r,l),y=d.catch((function(t){throw new s(t)})).then((function(t){if(h.clear(),!t.ok){if("opaque"===t.type){var r=new Error("Opaque response");throw r.status=t.status,r.response=t,r}return t[n.errorType||"text"]().then((function(r){var e=new Error(r);throw e[n.errorType||"text"]=r,e.status=t.status,e.response=t,e}))}return t})),v=function(r){return r.catch((function(r){h.clear();var e=r instanceof s?r.error:r;if(r instanceof s&&f.has("__fromFetch"))return f.get("__fromFetch")(e,t);if(f.has(e.status))return f.get(e.status)(e,t);if(f.has(e.name))return f.get(e.name)(e,t);throw e}))},m=function(t){return function(r){return v(t?y.then((function(r){return r&&r[t]()})).then((function(t){return r?r(t):t})):y.then((function(t){return r?r(t):t})))}},b={res:m(null),json:m("json"),blob:m("blob"),formData:m("formData"),arrayBuffer:m("arrayBuffer"),text:m("text"),perfs:function(t){return d.then((function(r){return i.observe(r.url,t)})).catch((function(){})),b},setTimeout:function(t,r){return void 0===r&&(r=p),h.clear(),h.ref=setTimeout((function(){return r.abort()}),t),b},controller:function(){return[p,b]},error:function(t,r){return f.set(t,r),b},badRequest:function(t){return b.error(400,t)},unauthorized:function(t){return b.error(401,t)},forbidden:function(t){return b.error(403,t)},notFound:function(t){return b.error(404,t)},timeout:function(t){return b.error(408,t)},internalError:function(t){return b.error(500,t)},fetchError:function(t){return b.error("__fromFetch",t)},onAbort:function(t){return b.error("AbortError",t)}};return u.reduce((function(r,e){return e(r,t)}),b)}((f=u?p?f.json(u,l):f.body(u):f)._deferredChain.reduce((function(t,r){return r(t,t._url,t._options)}),f))},o.prototype.get=function(t){return this.method("GET",t)},o.prototype.delete=function(t){return this.method("DELETE",t)},o.prototype.put=function(t,r){return this.method("PUT",r,t)},o.prototype.post=function(t,r){return this.method("POST",r,t)},o.prototype.patch=function(t,r){return this.method("PATCH",r,t)},o.prototype.head=function(t){return this.method("HEAD",t)},o.prototype.opts=function(t){return this.method("OPTIONS",t)},o.prototype.replay=function(t){return this.method(this._options.method,t)},o.prototype.body=function(r){return this.selfFactory({options:t(t({},this._options),{body:r})})},o.prototype.json=function(t,r){var e=c(this._options.headers);return this.content(r||a(e)&&e||"application/json").body(JSON.stringify(t))},o.prototype.formData=function(t,r){return void 0===r&&(r=!1),this.body(p(t,r))},o.prototype.formUrl=function(t){return this.body("string"==typeof t?t:(r=t,Object.keys(r).map((function(t){var e=r[t];return e instanceof Array?e.map((function(r){return h(t,r)})).join("&"):h(t,e)})).join("&"))).content("application/x-www-form-urlencoded");var r},o}(),l=function(t,r,e){var o;if("string"==typeof r)o=r;else{var i=n.polyfill("URLSearchParams",{instance:!0});for(var s in r)if(r[s]instanceof Array)for(var u=0,c=r[s];u<c.length;u++){var a=c[u];i.append(s,a)}else i.append(s,r[s]);o=i.toString()}var f=t.split("?");return o?e||f.length<2?f[0]+"?"+o:t+"&"+o:e?f[0]:t};function p(t,e,o,i){return void 0===e&&(e=!1),void 0===o&&(o=n.polyfill("FormData",{instance:!0})),void 0===i&&(i=[]),Object.entries(t).forEach((function(t){var n=t[0],s=t[1],u=i.reduce((function(t,r){return t?"".concat(t,"[").concat(r,"]"):r}),null);if(u=u?"".concat(u,"[").concat(n,"]"):n,s instanceof Array)for(var c=0,a=s;c<a.length;c++){var f=a[c];o.append(u+"[]",f)}else!e||"object"!=typeof s||e instanceof Array&&e.includes(n)?o.append(u,s):null!==s&&p(s,e,o,r(r([],i,!0),[n],!1))})),o}function h(t,r){return encodeURIComponent(t)+"="+encodeURIComponent("object"==typeof r?JSON.stringify(r):""+r)}var d=f.factory;return d.default=f.factory,d}));
//# sourceMappingURL=wretch.js.map
